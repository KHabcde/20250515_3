---

# ✅ 要件定義書：自然言語PC操作自動化システム（ハイブリッド構成）

## 1. 概要

本システムは、ユーザーが入力した自然言語によるPC操作命令を、独自のマクロ構文に変換し、PyAutoGUIやAutoHotkeyなどを使って実行する自動化システムである。自然言語の解析にはChatGPT（API経由）を利用し、Windows環境における業務オペレーションの自動化を目的とする。

---

## 2. 想定ユーザー

* 初心者エンジニア〜中級者
* Windows環境で日常的に業務アプリを操作しているユーザー
* コーディングに不慣れだが自動化を活用したい層

---

## 3. システム構成

### 🔹 表現言語：独自マクロ構文

cmd  arg1_1 arg1_2  arg2_1  arg2_2  ext1  ext2
click  x y
click  image image_filename
click  keyword word


* スペース1個またはスペース2個の区切りによる命令・引数の記述。
* cmdはコマンド名。
* arg1とarg2は引数群。一つの引数群の中に複数の引数を格納することができる
* arg1_1/arg1_2/arg2_1/arg2_2は引数。一つの引数群の中で、「x y」のようにスペースで区切って２つ以上の引数を入力することができる
* ext1/ext2は補足情報。コマンドごとにext1/ext2/ext3の意味が決まっており、入力内容と意味のセットはユーザーが構築できる
* cmd/arg1/arg2/ext1/ext2の区切りはスペース2個を用いる
* 引数群内の引数の区切りにはスペース1個を用いる
* 拡張可能なキーワード構文
* 自然言語からの変換に適した記法

---

### 🔹 実行エンジン：PyAutoGUI / AutoHotkey（バックエンド処理）

* PyAutoGUI：クリック、入力、スクリーンショット、画像認識等
* AutoHotkey（将来対応）：細かいウィンドウ制御やDLL呼び出し

---


### 🔹 補助技術

| 技術                  | 用途                                 |
| ------------------- | ---------------------------------- |
| ChatGPT API（有料版）    | 自然言語 → マクロ構文の変換                    |
| pywinauto           | UI構造の抽出（Print Control Identifiers） |
| pytesseract（OCR）    | UI上の文字認識                           |
| テンプレートマッチング（OpenCV） | アイコンなどの画像認識補助  
| pyautogui           | ユーザーのクリックから座標情報の取得　　|

---

## 4. 機能要件

### 4.1 入力系

* ユーザーは .txt ファイルまたはフォームで自然言語命令を入力できる
* 1文ずつ処理され、ログに進捗が表示される

### 4.2 変換系

* 自然言語命令をChatGPT APIを用いてマクロ構文に変換
* 変換失敗時はエラーとともにスキップ


### 4.3 マクロ構文の補足
* 引数としてimageやkeywordを与え、それら座標を特定する場合には、以下のようにユーザーとの対話を経てマクロ構文を作る
 1.プログラム側が座標の候補をいくつかユーザーに提案
 2.その中からユーザーが選択
 3.座標を確定
 4.確定した座標をもとにマクロ構文を再編する
* ユーザーが引数として与えたkeywordをもとに、プログラム側が座標の候補を挙げていく際、以下の方法を用いる
 - pywinauto(Print Control Identifier)によりウィンドウ内のUI情報を取得→grepを利用してkeywordの座標候補を得る
 - 画面のスクリーンショットを撮る→OCR→keywordの座標候補を得る
 - pyautoguiでユーザーにクリックさせる→keywordの座標候補を得る
* ユーザーが引数として与えたimageをもとに、プログラム側が座標の候補を挙げていく際、以下の方法を用いる
 - 画面のスクリーンショットを撮る→テンプレートマッチング→imageの座標候補を得る


### 4.4 実行系
「4.3マクロ構文の補足」を終えて完成したマクロ構文について、マクロ命令を1行ずつ解釈して、PyAutoGUIで実行
例外発生時はログに記録、次の命令に進む

---

## 5. 非機能要件

* 対象OS：Windows 10 / 11
* 対象アプリ：Chrome / Office製品 / 業務アプリ（UI自動化可能なもの）
* 実行形式：Pythonスクリプト（将来的にGUI化も可）
* 拡張性：新しいキーワード（例：Drag, Scroll）を随時追加できる構造
* セキュリティ：APIキーは環境変数にて管理

---

## 6. 将来的な拡張案

* GUIフロントエンド（例：簡易フォーム入力やログ出力）
* 自然言語テンプレートの登録・カスタマイズ機能
* 音声入力対応（音声→自然文→マクロ）
* AutoHotkeyバックエンドの統合による高精度自動化

---